---
title: API Reference
slug: /api
head: []
---

Shugur Relay provides both WebSocket (Nostr protocol) and HTTP APIs for different use cases.

## WebSocket API (Nostr Protocol)

The primary interface for Nostr clients. Follows the Nostr protocol specification.

### Connection

```javascript
const ws = new WebSocket('wss://your-relay.com');
```

### Message Types

#### EVENT

Send an event to the relay:

```json
["EVENT", {
	"id": "event_id",
	"pubkey": "public_key_hex",
	"created_at": 1672531200,
	"kind": 1,
	"tags": [],
	"content": "Hello, Nostr!",
	"sig": "signature_hex"
}]
```

Response:

```json
["OK", "event_id", true, ""]
```

#### REQ

Subscribe to events:

```json
["REQ", "subscription_id", {
	"authors": ["pubkey1", "pubkey2"],
	"kinds": [1, 6, 7],
	"since": 1672531200,
	"until": 1672617600,
	"limit": 100
}]
```

Response:

```json
["EVENT", "subscription_id", {"...": "event_object"}]
["EOSE", "subscription_id"]
```

#### CLOSE

Close a subscription:

```json
["CLOSE", "subscription_id"]
```

#### COUNT

Get event counts (NIP-45):

```json
["COUNT", "subscription_id", {
	"authors": ["pubkey1"],
	"kinds": [1]
}]
```

Response:

```json
["COUNT", "subscription_id", {"count": 42}]
```

### Supported NIPs

Shugur Relay implements the following Nostr Improvement Proposals:

#### Core Protocol

- NIP-01: Basic protocol flow description
- NIP-02: Contact List and Petnames
- NIP-03: OpenTimestamps Attestations for Events
- NIP-04: Encrypted Direct Message
- NIP-09: Event Deletion
- NIP-11: Relay Information Document

#### Enhanced Features

- NIP-15: End of Stored Events Notice
- NIP-16: Event Treatment
- NIP-17: Private Direct Messages
- NIP-20: Command Results
- NIP-22: Event created_at Limits
- NIP-23: Long-form Content
- NIP-24: Extra metadata fields and tags
- NIP-25: Reactions

#### Advanced Features

- NIP-26: Delegated Event Signing
- NIP-28: Public Chat
- NIP-33: Parameterized Replaceable Events
- NIP-40: Expiration Timestamp
- NIP-44: Encrypted Payloads (Versioned)
- NIP-45: Counting results
- NIP-50: Search Capability
- NIP-59: Gift Wrap
- NIP-65: Relay List Metadata
- NIP-78: Application-specific data

## HTTP API

REST endpoints for management and monitoring.

### Relay Information

GET /

Returns the relay information document (NIP-11):

```bash
curl -H "Accept: application/nostr+json" https://your-relay.com/
```

Response:

```json
{
	"name": "Your Relay Name",
	"description": "Your relay description",
	"pubkey": "relay_pubkey_hex",
	"contact": "admin@example.com",
	"supported_nips": [1, 2, 4, 9, 11, 15, 16, 20, 22, 33, 40],
	"software": "shugur-relay",
	"version": "1.0.0",
	"limitation": {
		"max_message_length": 16384,
		"max_subscriptions": 20,
		"max_filters": 100,
		"max_limit": 5000,
		"max_subid_length": 100,
		"max_event_tags": 100,
		"max_content_length": 8192,
		"min_pow_difficulty": 0,
		"auth_required": false,
		"payment_required": false,
		"created_at_lower_limit": 946684800,
		"created_at_upper_limit": 2147483647
	},
	"relay_countries": ["US"],
	"language_tags": ["en", "en-419"],
	"tags": ["sfw-only", "bitcoin-only"],
	"posting_policy": "https://example.com/posting-policy.html",
	"payments_url": "https://example.com/payments"
}
```

### Statistics

GET /api/stats

Get relay statistics:

```bash
curl https://your-relay.com/api/stats
```

Response:

```json
{
	"name": "Your Relay",
	"description": "Your relay description",
	"pubkey": "relay_pubkey_hex",
	"contact": "admin@example.com",
	"supported_nips": [1, 2, 4, 9, 11],
	"software": "shugur-relay",
	"version": "1.0.0",
	"uptime": "72h15m30s",
	"total_events": 150420,
	"total_connections": 89,
	"events_per_minute": 45,
	"memory_usage": "156MB",
	"database_size": "2.3GB"
}
```

### Health Check

GET /health

Simple health check endpoint:

```bash
curl https://your-relay.com/health
```

Response:

```json
{
	"status": "healthy",
	"timestamp": "2024-01-01T12:00:00Z",
	"uptime": "72h15m30s",
	"database": "connected"
}
```

### Search

GET /api/search

Search events (if NIP-50 is enabled):

```bash
curl "https://your-relay.com/api/search?q=bitcoin&kind=1&limit=10"
```

Parameters:

- q: Search query string
- kind: Event kind to search (optional)
- author: Author pubkey (optional)
- since: Unix timestamp (optional)
- until: Unix timestamp (optional)
- limit: Maximum results (default: 20, max: 100)

Response:

```json
{
	"events": [
		{
			"id": "event_id",
			"pubkey": "author_pubkey",
			"created_at": 1672531200,
			"kind": 1,
			"tags": [],
			"content": "Content containing bitcoin...",
			"sig": "signature"
		}
	],
	"count": 1
}
```

## Error Responses

### WebSocket Errors

```json
["OK", "event_id", false, "blocked: pubkey is blacklisted"]
["NOTICE", "Rate limited. Please slow down."]
["CLOSED", "subscription_id", "rate-limited"]
```

### HTTP Errors

```json
{
	"error": "invalid_request",
	"message": "Missing required parameter: q"
}
```

Common HTTP Status Codes:

- 400: Bad Request - Invalid parameters
- 403: Forbidden - Access denied
- 404: Not Found - Endpoint not found
- 429: Too Many Requests - Rate limited
- 500: Internal Server Error - Server error
- 503: Service Unavailable - Temporarily unavailable

## Rate Limiting

All APIs are subject to rate limiting:

- WebSocket: Configurable per-connection limits
- HTTP: Per-IP rate limiting
- Headers: Rate limit info in response headers:
	- X-RateLimit-Limit: Requests per window
	- X-RateLimit-Remaining: Remaining requests
	- X-RateLimit-Reset: Window reset time

## Authentication

Most endpoints are public, but some relay operators may require:

- NIP-42 Authentication: For protected relays
- API Keys: For management endpoints
- Payment: For premium features

## Client Libraries

### JavaScript/TypeScript

```bash
npm install nostr-tools
```

```javascript
import { Relay } from 'nostr-tools';

const relay = await Relay.connect('wss://your-relay.com');
```

### Python

```bash
pip install python-nostr
```

```python
from nostr.relay import Relay

relay = Relay("wss://your-relay.com")
```

### Go

```bash
go get github.com/nbd-wtf/go-nostr
```

```go
import "github.com/nbd-wtf/go-nostr"

relay, err := nostr.RelayConnect(ctx, "wss://your-relay.com")
```

## Testing

### WebSocket Testing

```bash
# Install wscat
npm install -g wscat

# Connect to relay
wscat -c wss://your-relay.com

# Send a REQ message
["REQ", "test", {"kinds": [1], "limit": 1}]
```

### HTTP Testing

```bash
# Test relay info
curl -H "Accept: application/nostr+json" https://your-relay.com/

# Test statistics
curl https://your-relay.com/api/stats

# Test health
curl https://your-relay.com/health
```

## Examples

### Publishing an Event

```javascript
import { Relay, Event } from 'nostr-tools';

const relay = await Relay.connect('wss://your-relay.com');

const event = new Event({
	kind: 1,
	content: "Hello, Nostr!",
	tags: [],
	created_at: Math.floor(Date.now() / 1000)
});

await event.sign(privateKey);
await relay.publish(event);
```

### Subscribing to Events

```javascript
const sub = relay.subscribe([
	{
		kinds: [1],
		authors: [pubkey],
		since: Math.floor(Date.now() / 1000) - 3600,
		limit: 50
	}
]);

sub.on('event', event => {
	console.log('Received event:', event);
});

sub.on('eose', () => {
	console.log('End of stored events');
});
```

## Related Documentation

- [Installation Guide](./installation)
- [Configuration Guide](./configuration)
- [Performance Guide](./performance)
- [Troubleshooting Guide](./troubleshooting)

